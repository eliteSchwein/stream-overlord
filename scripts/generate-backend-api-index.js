// scripts/generate-backend-api-index.cjs
const fs = require("fs");
const path = require("path");
const glob = require("glob");

// Folder that contains index.ts and all your Api files
const apiDir = path.join(__dirname, "..", "backend", "src", "api");

// Find all .ts files under api/, except index.ts and .d.ts
const files = glob.sync("**/*.ts", {
    cwd: apiDir,
    nodir: true,
    ignore: ["index.ts", "**/*.d.ts"],
});

// Use file basename (without extension) as export name
// e.g. "StatusApi.ts" -> "StatusApi"
function getExportName(file) {
    const base = path.basename(file, ".ts");
    return base; // your filenames already look like valid identifiers
}

const lines = [
    "// AUTO-GENERATED by scripts/generate-backend-api-index.js (npm run generate:backend-api-index)",
    "// Do not edit manually.",
    "",
];

files
    .sort()
    .forEach((file) => {
        const withoutExt = file.replace(/\.ts$/, "");
        const exportName = getExportName(file);

        // Normalize Windows paths to POSIX for TS imports
        const importPath = "./" + withoutExt.replace(/\\/g, "/");
        lines.push(`export { default as ${exportName} } from "${importPath}";`);
    });

lines.push(""); // final newline

const indexPath = path.join(apiDir, "index.ts");
fs.writeFileSync(indexPath, lines.join("\n"), "utf8");

console.log(`Generated ${indexPath} with ${files.length} exports.`);

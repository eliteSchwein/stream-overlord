import{j as p,G as f,a0 as m,b7 as d,k as v,o as h,aY as w,J as y,an as U,w as g,i as j,e as O,aZ as R}from"./index-Cf3JRyCJ.js";const k={class:"d-flex align-center justify-center h-100"},P=p({__name:"YoloboxPreview",props:{src:{},lazySrc:{},cover:{type:Boolean},debounceMs:{}},setup(a){const i=f(),c=a,n=U("");let s=null,o=null,r=null;function l(e){r&&URL.revokeObjectURL(r),r=e,n.value=e}async function u(e){o?.abort(),o=new AbortController;const t=await fetch(`${i.getRestApi}/api/yolobox/preview`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({target:e}),signal:o.signal});if(!t.ok)throw new Error(`Preview request failed (${t.status})`);const b=await t.blob();l(URL.createObjectURL(b))}return m(()=>c.src,e=>{e&&(clearTimeout(s),s=setTimeout(()=>{u(e).catch(t=>{t?.name})},c.debounceMs??120))},{immediate:!0}),d(()=>{clearTimeout(s),o?.abort(),r&&URL.revokeObjectURL(r)}),(e,t)=>(h(),v(w,y(e.$attrs,{src:n.value,"lazy-src":a.lazySrc,cover:a.cover}),{placeholder:g(()=>[j("div",k,[O(R,{indeterminate:""})])]),_:1},16,["src","lazy-src","cover"]))}});export{P as _};
